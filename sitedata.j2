# -*- coding: utf-8 -*-
# vim: ft=jinja2
####################
## APACHE AIRFLOW 
###################
{% set airflow_version = '2.1.3' %}
{% set loadbalancer    = 'controller01' %}
{% set primaryhost     = 'controller01' %}
{% set secondaryhost   = 'controller02' %}
{% set webserversecret = '123456789101112131415' %}

###########################
# if using ldap, set false
###########################
{% set create_user_group = true %}

#############
# Domainname
#############
{% set primarydomain   = 'controller' %}
{% set domain = salt['cmd.run']('hostname -d').split('.')[0]|lower|replace('none','localdomain') %}
{%- if domain in ('localdomain',) %}
    {%- set primarydomain = domain %}
    {%- set primarhost = localhost %}
{%- endif %}

#####################
### IN SCOPE DOMAINS
#####################
{% set names = ['localdomain', 'controller', 'apples', 'oranges', 'applestest'] %}
{% set names = names + ['orangestest', 'applesdev', 'orangesdev', 'edge', 'fog'] %}

{% set localdomain = {} %}
{% do localdomain.update({ 'fqdn':       '',
                           'auth_type':  'AUTH_DB',
                           'user':       'airflow',
                           'group':      'airflow',
                           'name':       'controller',
                           'workers':    {'controller01': '10.0.0.1', 'controller02': '10.0.0.2'},
                           'ldapserver': '',
                           'database':   '',
                           'ldapfilter': '',
                           'ldapbase':   ''}) %}

{% set controller = {} %}
{% do controller.update({ 'fqdn':       'CONTROLLER.NET',
                          'auth_type':  'AUTH_DB',
                          'user':       'airflowservice@CONTROLLER.NET',
                          'group':      'groupairflow@CONTROLLER.NET',
                          'name':       'controller',
                          'workers':    {'controller01': '10.0.1.1', 'controller02': '10.0.1.2'},
                          'ldapserver': 'controller-dc1.CONTROLLER.NET',
                          'database':   'airflow:airflow@controller01/airflow',
                          'ldapfilter': '(&(objectClass=user)(sAMAccountName=*)(|(memberOf=CN=grpRole_dataeng,OU=ouEngineers,DC=CONTROLLER,DC=NET)(memberOf=CN=grpRole_devops,OU=ouEngineers,DC=CONTROLLER,DC=NET))',
                          'ldapbase':   'OU=ouEngineers,DC=CONTROLLER,DC=NET'}) %}

{% set apples = {} %}
{% do apples.update({ 'fqdn':       'APPLES.NET',
                      'user':       'airflowservice@APPLES.NET',
                      'group':      'groupairflow@APPLES.NET',
                      'name':       'apples',
                      'workers':    {'worker01': '10.0.2.1', 'worker02': '10.0.2.2'},
                      'ldapserver': 'apples-dc1.apples.net',
                      'ldapfilter': '',
                      'database':   'airflow:airflow@controller01/airflow',
                      'ldapbase':   'OU=ouEngineers,DC=APPLES,DC=NET'}) %}

{% set oranges = {} %}
{% do oranges.update({ 'fqdn':       'ORANGES.NET',
                       'user':       'airflowservice@ORANGES.NET',
                       'group':      'groupairflow@ORANGES.NET',
                       'name':       'oranges',
                       'workers':    {'worker01': '10.0.3.1', 'worker02': '10.0.3.2'},
                       'ldapserver': 'oranges-dc1.oranges.net',
                       'ldapfilter': '',
                       'database':   'airflow:airflow@controller01/airflow',
                       'ldapbase':   'OU=ouEngineers,DC=ORANGES,DC=NET'}) %}

{% set applestest = {} %}
{% do applestest.update({ 'fqdn':       'APPLESTEST.NET',
                          'user':       'airflowservice@APPLESTEST.NET',
                          'group':      'groupairflow@APPLESTEST.NET',
                          'name':       'applestest',
                          'workers':    {'worker01': '10.0.4.1', 'worker02': '10.0.4.2'},
                          'ldapserver': 'apples-dc1.applestest.net',
                          'ldapfilter': '',
                          'database':   'airflow:airflow@controller01/airflow',
                          'ldapbase':   'OU=ouEngineers,DC=APPLESTEST,DC=NET'}) %}

{% set orangestest = {} %}
{% do orangestest.update({ 'fqdn':       'ORANGESTEST.NET',
                           'user':       'airflowservice@ORANGESTEST.NET',
                           'group':      'groupairflow@ORANGESTEST.NET',
                           'name':       'orangestest',
                           'workers':    {'worker01': '10.0.5.1', 'worker02': '10.0.5.2'},
                           'ldapserver': 'oranges-dc1.orangestest.net',
                           'ldapfilter': '',
                           'database':   'airflow:airflow@controller01/airflow',
                           'ldapbase':   'OU=ouEngineers,DC=ORANGESTEST,DC=NET'}) %}

{% set applesdev = {} %}
{% do applesdev.update({ 'fqdn':       'APPLESDEV.NET',
                         'user':       'airflowservice@APPLESDEV.NET',
                         'group':      'groupairflow@APPLESDEV.NET',
                         'name':       'applesdev',
                         'workers':    {'worker01': '10.0.6.1', 'worker02': '10.0.6.2'},
                         'ldapserver': 'apples-dc1.applesdev.net',
                         'ldapfilter': '',
                         'database':   'airflow:airflow@controller01/airflow',
                         'ldapbase':   'OU=ouEngineers,DC=APPLESDEV,DC=NET'}) %}

{% set orangesdev = {} %}
{% do orangesdev.update({ 'fqdn':       'ORANGESDEV.NET',
                          'user':       'airflowservice@ORANGESDEV.NET',
                          'group':      'groupairflow@ORANGESDEV.NET',
                          'name':       'orangesdev',
                          'workers':    {'worker01': '10.0.7.1', 'worker02': '10.0.7.2'},
                          'ldapserver': 'oranges-dc1.orangesdev.net',
                          'ldapfilter': '',
                          'database':   'airflow:airflow@controller01/airflow',
                          'ldapbase':   'OU=ouEngineers,DC=ORANGESDEV,DC=NET'}) %}

{% set edge = {} %}
{% do edge.update({ 'fqdn':       'EDGE.NET',
                    'user':       'airflowservice@EDGE.NET',
                    'group':      'groupairflow@EDGE.NET',
                    'name':       'edge',
                    'workers':    {'worker01': '10.0.8.1', 'worker02': '10.0.8.2'},
                    'ldapserver': 'edge-dc1.edge.net',
                    'ldapfilter': '',
                    'database':   'airflow:airflow@controller01/airflow',
                    'ldapbase':   'OU=ouEngineers,DC=EDGE,DC=NET'}) %}

{% set fog = {} %}
{% do fog.update({  'fqdn':       'FOG.NET',
                    'user':       'airflowservice',
                    'group':      'groupairflow@FOG.NET',
                    'name':       'fog',
                    'workers':    {'worker01': '10.0.9.1', 'worker02': '10.0.9.2'},
                    'ldapserver': 'fog-dc1.fog.net',
                    'ldapfilter': '',
                    'database':   'airflow:airflow@controller01/airflow',
                    'ldapbase':   'OU=ouEngineers,DC=FOG,DC=NET'}) %}
